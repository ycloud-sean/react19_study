<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>Day 2&colon; ReactDOM&#x5165;&#x53e3;&#x6587;&#x4ef6;&#x63a2;&#x7d22;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="day-2-reactdom入口文件探索">Day 2: ReactDOM入口文件探索</h1>
<h2 id="今日学习-todays-learning">今日学习 (Today's Learning)</h2>
<ul>
<li>核心概念: ReactDOM API结构、Portal概念、客户端渲染、服务端渲染、React 19新特性</li>
<li>重点文件: packages/react-dom/index.js</li>
</ul>
<h2 id="源码理解-source-code-understanding">源码理解 (Source Code Understanding)</h2>
<h3 id="文件-packagesreact-domindexjs">文件: packages/react-dom/index.js</h3>
<ul>
<li><strong>作用</strong>: ReactDOM的核心入口文件，专注于DOM操作和渲染功能</li>
<li><strong>关键内容</strong>:
<ul>
<li>DOM操作API（createPortal, flushSync）</li>
<li>资源预加载API（prefetchDNS, preconnect等）</li>
<li>表单处理Hooks（useFormState, useFormStatus）</li>
</ul>
</li>
<li><strong>核心逻辑</strong>:
<ul>
<li>通过export {...} from './src/shared/ReactDOM'将API转发到具体实现</li>
<li>相比React包的76个API，ReactDOM只有13个API，更加专注</li>
</ul>
</li>
</ul>
<h3 id="reactdom-vs-react的结构对比">ReactDOM vs React的结构对比</h3>
<table>
<thead>
<tr>
<th>React (packages/react/index.js)</th>
<th>ReactDOM (packages/react-dom/index.js)</th>
</tr>
</thead>
<tbody>
<tr>
<td>76个API导出</td>
<td>13个API导出</td>
</tr>
<tr>
<td>大量的Flow类型定义</td>
<td>只有内部模块导出</td>
</tr>
<tr>
<td>从ReactClient.js导入</td>
<td>从ReactDOM导入</td>
</tr>
<tr>
<td>组件、Hooks、工具函数</td>
<td>DOM操作、预加载、表单</td>
</tr>
</tbody>
</table>
<h2 id="portal概念深度解析">Portal概念深度解析</h2>
<h3 id="什么是portal">什么是Portal？</h3>
<p>Portal（传送门）是React提供的一个特殊API，它允许将子组件渲染到<strong>父组件DOM层次结构之外</strong>的DOM节点中。</p>
<h4 id="正常组件结构">正常组件结构</h4>
<pre><code>DOM结构：
&lt;div id=&quot;app&quot;&gt;
  &lt;ParentComponent&gt;
    &lt;ChildComponent /&gt;
  &lt;/ParentComponent&gt;
&lt;/div&gt;
</code></pre>
<h4 id="使用portal后的结构">使用Portal后的结构</h4>
<pre><code>DOM结构：
&lt;div id=&quot;app&quot;&gt;
  &lt;ParentComponent&gt;
    &lt;!-- 这里只是React组件的逻辑位置 --&gt;
  &lt;/ParentComponent&gt;
&lt;/div&gt;

&lt;!-- 但实际的DOM渲染在别处 --&gt;
&lt;div id=&quot;modal-root&quot;&gt;
  &lt;ChildComponent /&gt;
&lt;/div&gt;
</code></pre>
<h3 id="为什么需要portal">为什么需要Portal？</h3>
<h4 id="解决的核心问题">解决的核心问题</h4>
<p><strong>问题1：CSS层级限制</strong></p>
<ul>
<li>Modal（模态框）需要显示在页面最上层</li>
<li>如果Modal在父组件内，会被父组件的z-index限制</li>
<li>即使设置为z-index: 9999，也可能被其他元素遮挡</li>
</ul>
<p><strong>问题2：事件冒泡问题</strong></p>
<ul>
<li>某些情况下，事件需要&quot;跳出&quot;组件层级</li>
<li>比如点击Modal外部需要关闭Modal</li>
</ul>
<h3 id="实际应用场景">实际应用场景</h3>
<h4 id="1-模态框modal">1. 模态框（Modal）</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-comment">// children实际渲染在#modal-root中</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(children, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;modal-root&#x27;</span>));
}
</code></pre>
<h4 id="2-工具提示tooltip">2. 工具提示（Tooltip）</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Tooltip</span>(<span class="hljs-params">{ children, content }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;tooltip&quot;</span>&gt;</span>{content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>  <span class="hljs-comment">// 渲染到body中，避免被截断</span>
  );
}
</code></pre>
<h4 id="3-下拉菜单dropdown">3. 下拉菜单（Dropdown）</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Dropdown</span>(<span class="hljs-params">{ children, isOpen }</span>) {
  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;dropdown&quot;</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>
  );
}
</code></pre>
<h3 id="portal-vs-普通组件">Portal vs 普通组件</h3>
<h4 id="不使用portal的问题">不使用Portal的问题</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 问题：Dropdown被父容器裁剪</span>
&lt;div style={{ <span class="hljs-attr">overflow</span>: <span class="hljs-string">&#x27;hidden&#x27;</span>, <span class="hljs-attr">height</span>: <span class="hljs-string">&#x27;100px&#x27;</span> }}&gt;
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Dropdown</span> /&gt;</span></span>
&lt;/div&gt;
</code></pre>
<h4 id="使用portal的解决方案">使用Portal的解决方案</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 解决方案：Dropdown渲染到body中</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dropdown</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;dropdown&quot;</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>
  );
}
</code></pre>
<h3 id="portal的优势">Portal的优势</h3>
<ol>
<li>
<p><strong>突破DOM层级限制</strong></p>
<ul>
<li>避免z-index冲突</li>
<li>不受父容器的overflow影响</li>
</ul>
</li>
<li>
<p><strong>语义化更好</strong></p>
<ul>
<li>Modal逻辑上属于某个组件</li>
<li>但物理上在页面最外层</li>
</ul>
</li>
<li>
<p><strong>保持React生命周期</strong></p>
<ul>
<li>Portal内部的组件仍然受父组件控制</li>
<li>状态更新仍然正常工作</li>
</ul>
</li>
</ol>
<h2 id="客户端渲染-vs-服务端渲染">客户端渲染 vs 服务端渲染</h2>
<h3 id="基本概念对比">基本概念对比</h3>
<table>
<thead>
<tr>
<th>维度</th>
<th>客户端渲染（CSR）</th>
<th>服务端渲染（SSR）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>渲染位置</strong></td>
<td>浏览器中</td>
<td>服务器中</td>
</tr>
<tr>
<td><strong>HTML生成</strong></td>
<td>浏览器运行JS后</td>
<td>服务器生成HTML</td>
</tr>
<tr>
<td><strong>首屏时间</strong></td>
<td>较慢（需加载JS）</td>
<td>较快（直接显示HTML）</td>
</tr>
<tr>
<td><strong>SEO支持</strong></td>
<td>较差</td>
<td>较好</td>
</tr>
</tbody>
</table>
<h3 id="渲染流程对比">渲染流程对比</h3>
<h4 id="客户端渲染csr流程">客户端渲染（CSR）流程</h4>
<pre><code>1. 用户访问网站
2. 下载HTML文件（通常很小）
3. 下载JavaScript bundle
4. 浏览器运行JS
5. React渲染组件
6. 显示页面内容
</code></pre>
<h4 id="服务端渲染ssr流程">服务端渲染（SSR）流程</h4>
<pre><code>1. 用户访问网站
2. 服务器执行React代码
3. 生成完整的HTML
4. 发送HTML给浏览器
5. 浏览器显示页面
6. 浏览器下载JS hydrate（激活）
</code></pre>
<h3 id="具体区别详解">具体区别详解</h3>
<h4 id="1-首屏时间first-contentful-paint">1. 首屏时间（First Contentful Paint）</h4>
<p><strong>CSR问题</strong>：</p>
<pre><code>用户访问 → 白屏 → 加载JS → 页面显示
     ↓          ↓         ↓
   0ms      500ms     1000ms
</code></pre>
<p><strong>SSR优势</strong>：</p>
<pre><code>用户访问 → 页面显示 → 加载JS → 页面交互
     ↓         ↓         ↓
   0ms      100ms     800ms
</code></pre>
<h4 id="2-seo搜索引擎优化">2. SEO（搜索引擎优化）</h4>
<p><strong>CSR问题</strong>：</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- 搜索引擎爬虫看到的内容 --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的应用<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 没有实际内容 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>SSR优势</strong>：</p>
<pre><code class="language-html"><span class="hljs-comment">&lt;!-- 搜索引擎爬虫看到的内容 --&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的应用<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>欢迎来到我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这里有丰富的页面内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>React应用在这里激活<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 id="3-交互时间time-to-interactive">3. 交互时间（Time to Interactive）</h4>
<p><strong>CSR</strong>：</p>
<pre><code>首次显示慢，需要等待JS加载和执行
</code></pre>
<p><strong>SSR</strong>：</p>
<pre><code>显示快，但交互需要等待JS加载完成
</code></pre>
<h4 id="4-服务器负载">4. 服务器负载</h4>
<p><strong>CSR</strong>：</p>
<pre><code>服务器：只提供静态文件
客户端：承担所有渲染工作
</code></pre>
<p><strong>SSR</strong>：</p>
<pre><code>服务器：执行React代码，生成HTML
客户端：相对简单，主要负责hydration
</code></pre>
<h3 id="react在不同环境的角色">React在不同环境的角色</h3>
<h4 id="客户端渲染中的react">客户端渲染中的React</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 在浏览器中</span>
<span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/client&#x27;</span>;

<span class="hljs-keyword">const</span> root = <span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>));
root.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
<span class="hljs-comment">// React完全在浏览器中运行</span>
</code></pre>
<h4 id="服务端渲染中的react">服务端渲染中的React</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 在Node.js服务器中</span>
<span class="hljs-keyword">import</span> { renderToString } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/server&#x27;</span>;

<span class="hljs-keyword">const</span> html = <span class="hljs-title function_">renderToString</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
<span class="hljs-comment">// 服务器生成HTML，发送给浏览器</span>
</code></pre>
<h3 id="react-api在不同环境的差异">React API在不同环境的差异</h3>
<h4 id="react包通用">React包（通用）</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 无论客户端还是服务端，都可以用</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Component</span>, useState, createElement } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-comment">// 这些是React的核心逻辑</span>
</code></pre>
<h4 id="reactdom包环境相关">ReactDOM包（环境相关）</h4>
<p><strong>客户端</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/client&#x27;</span>;
<span class="hljs-title function_">createRoot</span>(container).<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
<span class="hljs-comment">// 客户端渲染</span>
</code></pre>
<p><strong>服务端</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { renderToString } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom/server&#x27;</span>;
<span class="hljs-keyword">const</span> html = <span class="hljs-title function_">renderToString</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
<span class="hljs-comment">// 服务端渲染</span>
</code></pre>
<h2 id="react-19新增特性分析">React 19新增特性分析</h2>
<h3 id="1-表单相关的hooks重点新增">1. 表单相关的Hooks（重点新增）</h3>
<p>React 19引入了全新的表单处理机制：</p>
<h4 id="useformstate">useFormState</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// React 19新增</span>
<span class="hljs-keyword">export</span> { useFormState };
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>简化表单提交逻辑</li>
<li>自动处理表单状态和错误</li>
<li>与Form actions API集成</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useFormState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Form</span>(<span class="hljs-params">{ action }</span>) {
  <span class="hljs-keyword">const</span> [state, formAction] = <span class="hljs-title function_">useFormState</span>(action, <span class="hljs-literal">null</span>);

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{formAction}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {state.error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{state.error}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<h4 id="useformstatus">useFormStatus</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// React 19新增</span>
<span class="hljs-keyword">export</span> { useFormStatus };
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>跟踪表单提交状态</li>
<li>提供loading、pending等状态</li>
<li>改善用户体验</li>
</ul>
<p><strong>使用示例</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { useFormStatus } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SubmitButton</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> { pending } = <span class="hljs-title function_">useFormStatus</span>();

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{pending}</span>&gt;</span>
      {pending ? &#x27;提交中...&#x27; : &#x27;提交&#x27;}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<h3 id="2-资源预加载api性能优化">2. 资源预加载API（性能优化）</h3>
<p>React 19大幅增强了资源预加载能力：</p>
<h4 id="dns预获取">DNS预获取</h4>
<pre><code class="language-javascript"><span class="hljs-comment">// 新增</span>
<span class="hljs-keyword">export</span> { prefetchDNS };
</code></pre>
<p><strong>作用</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { prefetchDNS } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedLink</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 预解析DNS</span>
  <span class="hljs-title function_">prefetchDNS</span>(<span class="hljs-string">&#x27;https://example.com&#x27;</span>);

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://example.com&quot;</span>&gt;</span>Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
  );
}
</code></pre>
<h4 id="预连接">预连接</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">export</span> { preconnect };
</code></pre>
<p><strong>作用</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { preconnect } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedLink</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 建立连接</span>
  <span class="hljs-title function_">preconnect</span>(<span class="hljs-string">&#x27;https://api.example.com&#x27;</span>);

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://api.example.com&quot;</span>&gt;</span>API Link<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
  );
}
</code></pre>
<h4 id="资源预加载">资源预加载</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">export</span> { preload };
</code></pre>
<p><strong>作用</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { preload } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedImage</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 预加载图片</span>
  <span class="hljs-title function_">preload</span>(<span class="hljs-string">&#x27;/image.jpg&#x27;</span>, {
    <span class="hljs-attr">as</span>: <span class="hljs-string">&#x27;image&#x27;</span>,
    <span class="hljs-attr">fetchPriority</span>: <span class="hljs-string">&#x27;high&#x27;</span>
  });

  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/image.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Example&quot;</span> /&gt;</span></span>;
}
</code></pre>
<h4 id="模块预加载">模块预加载</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">export</span> { preloadModule };
</code></pre>
<p><strong>作用</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { preloadModule } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedModule</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 预加载JS模块</span>
  <span class="hljs-title function_">preloadModule</span>(<span class="hljs-string">&#x27;/module.js&#x27;</span>);

  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Module<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h4 id="预初始化">预初始化</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">export</span> { preinit };
</code></pre>
<p><strong>作用</strong>：</p>
<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { preinit } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">OptimizedResource</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// 预初始化资源</span>
  <span class="hljs-title function_">preinit</span>(<span class="hljs-string">&#x27;https://cdn.example.com/style.css&#x27;</span>, {
    <span class="hljs-attr">as</span>: <span class="hljs-string">&#x27;style&#x27;</span>,
    <span class="hljs-attr">crossOrigin</span>: <span class="hljs-string">&#x27;anonymous&#x27;</span>
  });

  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h4 id="模块预初始化">模块预初始化</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">export</span> { preinitModule };
</code></pre>
<h3 id="react-19-新增api总结">React 19 新增API总结</h3>
<table>
<thead>
<tr>
<th>API类型</th>
<th>API名称</th>
<th>作用</th>
<th>解决的问题</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>表单Hooks</strong></td>
<td><code>useFormState</code></td>
<td>表单状态管理</td>
<td>简化表单处理</td>
</tr>
<tr>
<td><strong>表单Hooks</strong></td>
<td><code>useFormStatus</code></td>
<td>表单提交状态</td>
<td>改善用户体验</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td><code>prefetchDNS</code></td>
<td>DNS预解析</td>
<td>加速资源加载</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td><code>preconnect</code></td>
<td>预连接</td>
<td>减少网络延迟</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td><code>preload</code></td>
<td>资源预加载</td>
<td>优化资源加载顺序</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td><code>preloadModule</code></td>
<td>模块预加载</td>
<td>优化JS模块加载</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td><code>preinit</code></td>
<td>资源预初始化</td>
<td>更快资源可用性</td>
</tr>
<tr>
<td><strong>性能优化</strong></td>
<td><code>preinitModule</code></td>
<td>模块预初始化</td>
<td>优化模块初始化</td>
</tr>
</tbody>
</table>
<h3 id="react-19的设计理念">React 19的设计理念</h3>
<h4 id="1-表单处理简化">1. 表单处理简化</h4>
<ul>
<li>减少样板代码</li>
<li>更好的错误处理</li>
<li>改进的用户反馈</li>
</ul>
<h4 id="2-性能优先">2. 性能优先</h4>
<ul>
<li>资源预加载机制</li>
<li>网络优化</li>
<li>用户感知性能提升</li>
</ul>
<h4 id="3-开发者体验">3. 开发者体验</h4>
<ul>
<li>更好的DX（Developer Experience）</li>
<li>自动化优化</li>
<li>减少手动优化需求</li>
</ul>
<h3 id="与其他react版本的对比">与其他React版本的对比</h3>
<table>
<thead>
<tr>
<th>版本</th>
<th>主要特性</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>React 16</strong></td>
<td>Hooks</td>
</tr>
<tr>
<td><strong>React 17</strong></td>
<td>Concurrent Mode准备</td>
</tr>
<tr>
<td><strong>React 18</strong></td>
<td>Concurrent Features、Suspense</td>
</tr>
<tr>
<td><strong>React 19</strong></td>
<td><strong>表单Hooks、资源预加载、性能优化</strong></td>
</tr>
</tbody>
</table>
<h2 id="代码片段-code-snippets">代码片段 (Code Snippets)</h2>
<h3 id="reactdom-api分类示例">ReactDOM API分类示例</h3>
<pre><code class="language-javascript"><span class="hljs-comment">// DOM操作核心</span>
<span class="hljs-keyword">export</span> {
  createPortal,    <span class="hljs-comment">// 创建Portal</span>
  flushSync,       <span class="hljs-comment">// 同步刷新</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/shared/ReactDOM&#x27;</span>;

<span class="hljs-comment">// 资源预加载（React 19新增）</span>
<span class="hljs-keyword">export</span> {
  prefetchDNS,      <span class="hljs-comment">// DNS预获取</span>
  preconnect,       <span class="hljs-comment">// 预连接</span>
  preload,          <span class="hljs-comment">// 预加载资源</span>
  preloadModule,    <span class="hljs-comment">// 预加载模块</span>
  preinit,          <span class="hljs-comment">// 预初始化</span>
  preinitModule,    <span class="hljs-comment">// 预初始化模块</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/shared/ReactDOM&#x27;</span>;

<span class="hljs-comment">// 表单处理（React 19新增）</span>
<span class="hljs-keyword">export</span> {
  useFormState,     <span class="hljs-comment">// 表单状态Hook</span>
  useFormStatus,    <span class="hljs-comment">// 表单状态Hook</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/shared/ReactDOM&#x27;</span>;
</code></pre>
<h3 id="portal实际应用示例">Portal实际应用示例</h3>
<pre><code class="language-javascript"><span class="hljs-comment">// 模态框组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-overlay&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;modal-content&quot;</span>&gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;modal-root&#x27;</span>)
  );
}

<span class="hljs-comment">// 工具提示组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Tooltip</span>(<span class="hljs-params">{ children, content }</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;tooltip&quot;</span>&gt;</span>{content}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>  <span class="hljs-comment">// 渲染到body中，避免被截断</span>
  );
}

<span class="hljs-comment">// 下拉菜单组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dropdown</span>(<span class="hljs-params">{ children, isOpen }</span>) {
  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPortal</span>(
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;dropdown&quot;</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>
  );
}
</code></pre>
<h3 id="react-19-表单hook示例">React 19 表单Hook示例</h3>
<pre><code class="language-javascript"><span class="hljs-comment">// useFormState 示例</span>
<span class="hljs-keyword">import</span> { useFormState } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyForm</span>(<span class="hljs-params">{ action }</span>) {
  <span class="hljs-keyword">const</span> [state, formAction] = <span class="hljs-title function_">useFormState</span>(action, <span class="hljs-literal">null</span>);

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{formAction}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {state.error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{state.error}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// useFormStatus 示例</span>
<span class="hljs-keyword">import</span> { useFormStatus } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SubmitButton</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> { pending } = <span class="hljs-title function_">useFormStatus</span>();

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{pending}</span>&gt;</span>
      {pending ? &#x27;提交中...&#x27; : &#x27;提交&#x27;}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<h2 id="疑问点-questions">疑问点 (Questions)</h2>
<ol>
<li>
<p><strong>Portal在服务端渲染中的限制</strong>？</p>
<ul>
<li>服务端是否有Portal的限制？</li>
<li>跨域Portal是否支持？</li>
</ul>
</li>
<li>
<p><strong>资源预加载的性能收益</strong>？</p>
<ul>
<li>预加载API的实际性能提升如何？</li>
<li>如何避免过度预加载？</li>
</ul>
</li>
<li>
<p><strong>表单Hook的向后兼容</strong>？</p>
<ul>
<li>现有表单如何迁移到新Hook？</li>
<li>性能影响如何？</li>
</ul>
</li>
<li>
<p><strong>ReactDOM vs React职责分离</strong>？</p>
<ul>
<li>为什么需要两个独立的包？</li>
<li>未来的发展方向是什么？</li>
</ul>
</li>
</ol>
<h2 id="实践验证-practical-verification">实践验证 (Practical Verification)</h2>
<ul class="contains-task-list">
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> 阅读并理解了ReactDOM入口文件的结构</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> 了解了ReactDOM的13个API及其分类</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> 理解了Portal的概念和应用场景</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> 学习了客户端渲染vs服务端渲染的区别</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox" checked=""type="checkbox"> 掌握了React 19的新特性</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 实际编写Portal组件测试理解</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 运行ReactDOM相关测试</li>
<li class="task-list-item enabled"><input class="task-list-item-checkbox"type="checkbox"> 探索React 19的新Hook实际效果</li>
</ul>
<h2 id="明日任务-tomorrows-tasks">明日任务 (Tomorrow's Tasks)</h2>
<ol>
<li>
<p><strong>重点文件</strong>:</p>
<ul>
<li>packages/react/src/ReactClient.js (第1-30行)</li>
<li>scripts/rollup/build.js (前50行)</li>
</ul>
</li>
<li>
<p><strong>学习目标</strong>:</p>
<ul>
<li>理解ReactClient的结构</li>
<li>了解主要模块的导入</li>
<li>了解React构建流程</li>
<li>学习构建错误的调试基础</li>
</ul>
</li>
<li>
<p><strong>实践建议</strong>:</p>
<ul>
<li>尝试构建React</li>
<li>观察构建输出</li>
<li>理解构建错误信息</li>
</ul>
</li>
</ol>
<h2 id="总结-summary">总结 (Summary)</h2>
<p>今天深入学习了ReactDOM的API结构和核心概念。通过分析Portal机制，理解了React如何突破DOM层级限制，解决了模态框、工具提示等实际应用问题。对比了客户端渲染和服务端渲染的优缺点，明确了两者的适用场景。重点关注了React 19的新特性，包括表单处理Hooks和资源预加载API，这些新特性将显著改善开发者体验和性能表现。</p>
<p>通过今天的学习，对React生态系统的复杂性有了更深入的理解，React专注于UI逻辑，ReactDOM专注于DOM操作，两者分工明确但又紧密协作。这种模块化的设计为React的可扩展性和维护性提供了重要支撑。</p>

            
            
        </body>
        </html>